# -*- coding: utf-8 -*-
from graph import Graph2D, osm

graph_5 = {
    'nodes': [(400, 100), (150, 220), (500, 350), (600, 950),
              (770, 80)],
    'edges': [[4], [3, 2], [3, 4]],
    'distance': 3347
}

graph_7 = {
    'nodes': [(400, 100), (444, 544), (363, 320), (600, 950),
              (770, 80), (500, 500), (200, 420)],
    'edges': [[2, 4, 5], [2, 5, 6], [5, 6], [5, 6], [5]],
    'distance': 2555
}

graph_9 = {
    'nodes': [(342, 729), (120, 101), (460, 958), (819, 490),
              (926, 517), (382, 438), (467, 615),
              (884, 148), (296, 511)],
    'edges': [[1, 2, 6, 5], [5, 7], [4, 6], [4, 6, 5, 7], [7], [8, 6, 7]],
    'distance': 3146
}

graph_15 = {'nodes': [(336, 334), (444, 464), (722, 364), (737, 298),
                      (896, 479), (803, 194), (479, 938), (809, 779),
                      (143, 101), (909, 586), (909, 64), (617, 203),
                      (746, 456), (645, 335), (628, 896)],
            'edges': [[1, 11, 6], [2, 7, 11, 12, 14], [3, 4], [5, 13],
                      [9, 10, 5], [8], [8, 14], [12, 14], [10], [12],
                      [], [13]]}

graph_23 = {'nodes': [(571, 88), (880, 321), (622, 247), (173, 232),
                      (900, 576), (858, 364), (377, 762), (310, 484),
                      (890, 894), (283, 714), (117, 125), (670, 683),
                      (569, 137), (127, 70), (697, 712), (889, 874),
                      (344, 418), (227, 489), (57, 602), (652, 892),
                      (321, 620), (407, 922), (911, 437)],
            'edges': [[12, 1, 13, 16], [12, 2, 5, 22], [12, 16, 6, 11, 4],
                      [18, 13, 10, 17, 16], [5, 22, 14, 15], [2],
                      [9, 20, 11, 14, 21, 19], [17, 16, 20], [15, 19, 14],
                      [18, 17, 20, 21], [18], [], [], [], [], [], [], [],
                      [21], [21]]}


graph_48_us = {
    'nodes': [(6734, 1453), (2233, 10), (5530, 1424), (401, 841),
              (3082, 1644), (7608, 4458), (7573, 3716), (7265, 1268),
              (6898, 1885), (1112, 2049), (5468, 2606), (5989, 2873),
              (4706, 2674), (4612, 2035), (6347, 2683), (6107, 669),
              (7611, 5184), (7462, 3590), (7732, 4723), (5900, 3561),
              (4483, 3369), (6101, 1110), (5199, 2182), (1633, 2809),
              (4307, 2322), (675, 1006), (7555, 4819), (7541, 3981),
              (3177, 756), (7352, 4506), (7545, 2801), (3245, 3305),
              (6426, 3173), (4608, 1198), (23, 2216), (7248, 3779),
              (7762, 4595), (7392, 2244), (3484, 2829), (6271, 2135),
              (4985, 140), (1916, 1569), (7280, 4899), (7509, 3239),
              (10, 2676), (6807, 2993), (5185, 3258), (3023, 1942)],
    'edges': [[8, 7, 21, 22, 2], [25, 28, 9, 4, 40, 3], [21, 22, 33, 40, 13],
              [25], [41, 47, 38, 13, 33, 24], [27, 36, 29, 35], [17, 27],
              [37, 21, 8], [39, 37, 45, 30, 22], [44, 23, 25, 41],
              [11, 12, 22, 39, 46], [14, 45, 19], [24, 46, 31],
              [24, 22, 33], [39], [40, 21, 7], [26, 42], [43, 45, 35],
              [26, 36], [32, 46, 29, 35],
              [46, 31, 12, 42], [], [], [41, 31, 47, 44],
              [], [], [], [], [33], [42, 35], [43, 37], [38], [45],
              [40], [44], [45], [], [], [47]]
}


graph_100 = {
    'nodes': [(6734, 1453), (2233, 10), (5530, 1424), (401, 841),
              (3082, 1644), (7608, 4458), (7573, 3716), (7265, 1268),
              (6898, 1885), (1112, 2049), (5468, 2606), (5989, 2873),
              (4706, 2674), (4612, 2035), (6347, 2683), (6107, 669),
              (7611, 5184), (7462, 3590), (7732, 4723), (5900, 3561),
              (4483, 3369), (6101, 1110), (5199, 2182), (1633, 2809),
              (4307, 2322), (675, 1006), (7555, 4819), (7541, 3981),
              (3177, 756), (7352, 4506), (7545, 2801), (3245, 3305),
              (6426, 3173), (4608, 1198), (23, 2216), (7248, 3779),
              (7762, 4595), (7392, 2244), (3484, 2829), (6271, 2135),
              (4985, 140), (1916, 1569), (7280, 4899), (7509, 3239),
              (10, 2676), (6807, 2993), (5185, 3258), (3023, 1942),
              (9854, 3299), (8789, 5816), (4299, 7211), (3129, 3459),
              (8417, 3404), (9038, 7965), (7277, 3671), (820, 413),
              (1903, 7931), (9994, 2529), (8577, 2036), (6197, 795),
              (9809, 9110), (7105, 9743), (5580, 6294), (1450, 5000),
              (5222, 1221), (4089, 6377), (9189, 2618), (7448, 9847),
              (532, 1090), (5756, 5570), (9387, 6512), (3524, 2525),
              (523, 2226), (7678, 2622), (7127, 1096), (7868, 6802),
              (3113, 7505), (6474, 7491), (9050, 1259), (2530, 9239),
              (2738, 340), (6208, 4089), (9652, 5298), (4888, 9087),
              (1034, 225), (2383, 1966), (9175, 3591), (4996, 9809),
              (2026, 2591), (7557, 6567), (9552, 670), (1575, 1589),
              (1573, 2423), (244, 1299), (2866, 3187), (8323, 4683),
              (2853, 6417), (8944, 7752), (6207, 4244), (7416, 7461)],
    'edges': [[8, 7, 21, 22, 2], [25, 28, 9, 4, 40, 3],  # 2
              [21, 22, 33, 40, 13],  # 3
              [25], [41, 47, 38, 13, 33, 24], [27, 36, 29, 35], [17, 27],  # 7
              [37, 21, 8, 90], [39, 37, 45, 30, 22], [44, 23, 25, 41],  # 10
              [11, 12, 22, 39, 46], [14, 45, 19], [24, 46, 31],  # 13
              [24, 22, 33], [39], [40, 21, 7],  # 16
              [26, 42, 69, 89, 95], [43, 45, 35],  # 18
              [26, 36], [32, 46, 29, 35], [46, 31, 12, 42, 96, 65, 69],  # 21
              [], [], [41, 31, 47, 44, 63, 96],  # 24
              [], [], [], [], [33], [42, 35],  # 30
              [43, 37, 95, 52, 58], [38], [45],  # 33
              [40], [44], [45], [], [],  # 38
              [47], [], [], [], [], [], [],  # 45
              [], [], [], [86, 57, 82], [89, 75, 95, 86, 82, 70],  # 50
              [65, 83, 76, 96, 62], [], [86, 58, 66],  # 53
              [97, 60, 70, 99, 75], [],  # 55
              [], [63, 79, 76], [66, 78, 58, 90], [], [],  # 60
              [67], [67, 99, 77, 87, 83], [69, 77, 89, 99], [], [],  # 65
              [], [], [], [], [],  # 70
              [], [], [], [], [],  # 75
              []]
}

graph_vln = {
    'nodes':
    [(500, 500), (360, 450), (280, 415), (220, 410), (140, 395), (6, 380),  # 6
     (450, 570), (430, 620), (450, 690), (460,
                                          750), (500, 930), (515, 1000),  # 12
     (460, 970), (440, 910), (380, 990), (150, 1100),  # 16
     (400, 700), (290, 700), (235, 705), (270, 560),  # 20
     (270, 800), (290, 870), (350, 840), (240, 920), (50, 1000),  # 25
     (50, 750), (50, 550), (150, 560), (130, 630), (150, 490),  # 30
     (500, 400), (580, 400), (470, 250), (450, 185), (400, 70),  # 35
     (510, 0), (560, 100), (590, 200), (630, 290), (630, 440),  # 40
     (630, 520), (600, 580), (780, 680), (810, 390), (720, 420),  # 45
     (810, 300), (770, 220), (780, 130), (680, 170), (720, 270),  # 50
     (700, 100), (705, 20), (755, 0), (860, 50), (920, 170),  # 55
     (970, 270), (1000, 190), (910, 260), (880, 350), (1000, 330),  # 60
     (1000, 0), (300, 285), (330, 230), (240, 345), (150, 325),  # 65
     (50, 285), (130, 185), (30, 155), (50, 55), (0, 0),  # 70
     (150, 55), (250, 105), (590, 660), (750, 760), (1000, 1000),  # 75
     (800, 780), (1000, 700), (520, 830), (650, 980), (850, 990)
     ],
    'edges':
    [[1, 6], [2], [3], [4], [5], [],  # 6
     [7], [1, 8], [9], [10], [11], [],  # 12
     [10, 13], [], [12, 15], [],  # 16
     [8], [16, 18], [19], [2, 16],  # 20
     [17, 18, 21], [22], [9, 20], [21, 14, 24],  # 25
     [], [18], [], [26, 19, 28, 29], [], [],  # 30
     [1, 0, 31], [], [30, 33], [], [33, 35],  # 35
     [], [35, 33], [36, 32, 38], [32], [0, 38],  # 40
     [39, 41], [6], [41, 43], [], [43, 40, 39],  # 45
     [43, 46], [], [46, 48], [37, 38, 49], [44, 43],  # 50
     [48, 51, 36, 47], [], [51], [51, 47], [47, 55, 56],  # 55
     [], [], [54, 46], [43, 45, 59], [],  # 60
     [53], [2, 62], [32, 33], [3, 61], [4, 63, 61],  # 65
     [64], [65, 62], [66], [67, 69], [],  # 70
     [68, 66], [66, 62, 34], [41, 73], [42], [],  # 75
     [73, 42, 74, 76], [], [10, 9], [10, 77, 79]
     ]
}


def make_graph_from_data(data):
    g = Graph2D()
    for n in xrange(0, len(data['nodes'])):
        g.add_coord_node(n, data['nodes'][n])
    for n in xrange(0, len(data['edges'])):
        for m in data['edges'][n]:
            g.add_double_edge(n, m)
    return g


def _graph_demaker_(nodes):
    graph = Graph2D.generate_random(nodes, 2)
    _print_graph_data_(graph)
    graph.show()


def _print_graph_data_(graph):
    data = {}
    coords = []
    edges = []
    for n in graph.nodes():
        edges.append([])
        coords.append(graph.node[n]['pos'])
    data['nodes'] = coords
    for edge in graph.edges():
        edges[edge[0]].append(edge[1])
    data['edges'] = edges
    print data


def g_9():
    return make_graph_from_data(graph_9)


def g_15():
    return make_graph_from_data(graph_15)


def g_23():
    return make_graph_from_data(graph_23)


def g_48():
    return make_graph_from_data(graph_48_us)


def g_vln():
    g = make_graph_from_data(graph_vln)
    return g


def g_100():
    g = make_graph_from_data(graph_100)
    __clean(g)
    return g


def _simplify_graph(g):
    removed = []
    for n in g.nodes():
        if n in removed:
            continue
        ns1 = g.neighbors(n)
        if len(ns1) == 2:
            for neighbor in ns1:
                ns2 = g.neighbors(neighbor)
                ns2.remove(n)
                if len(ns2) == 1:
                    removed.append(neighbor)
                    g.remove_node(neighbor)
                    g.add_double_edge(n, ns2[0])
    ng = Graph2D()
    for n in g.nodes():
        ng.add_coord_node(n, g.node[n]['pos'])
    for edge in g.edges():
        ng.add_double_edge(edge[0], edge[1])
    return ng


def __clean(g):
    first_node = None
    to_delete = []
    for n in g.nodes_iter():
        if first_node is None:
            first_node = n
            continue
        if g.path_between(first_node, n) is None:
            to_delete.append(n)
    [g.remove_node(n) for n in to_delete]


def vilniaus_senamiestis(use_small=True):
    if use_small:
        g = osm.read_osm("graph/vilniaus_senamiestis (smaller).osm", True)
    else:
        g = osm.read_osm("graph/vilniaus_senamiestis (bigger).osm", True)
    first_node = None
    to_delete = []
    for n in g.nodes_iter():
        if first_node is None:
            first_node = n
            continue
        if g.path_between(first_node, n) is None:
            to_delete.append(n)
    [g.remove_node(n) for n in to_delete]
    g = _simplify_graph(g)
    return g
